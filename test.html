<!DOCTYPE html>
<html>
<head>
    <title>To Do APP</title>
</head>
<body  ng-app="myApp" ng-controller="todoCtrl">

<h2 style="color: #ccff33">My Todo List</h2>

<form ng-submit="todoAdd(newtodoInput)">
    <input type="text" ng-model="newtodoInput" size="50" placeholder="Add New">
    <input type="submit" value="Add New">
</form>

<div>Incompleted : {{remaining()}}</div>
<div>Completed : {{todoList.length - remaining()}}</div>

<br>

<div ng-repeat="todo in todoList">
    <input type="checkbox" ng-model="todo.completed" > <span ng-bind="todo.subject"></span>
</div>

<p><button ng-click="remove(todo)">Remove marked</button></p>

<script src="http://ajax.googleapis.com/ajax/libs/angularjs/1.4.8/angular.min.js"></script>
<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>

<script>
var app = angular.module('myApp', []);
app.controller('todoCtrl', function($scope,$http) {
    $scope.todoList = [{subject:'Clean House', done:false}];

    // $scope.todoAdd = function() {
    //     $scope.todoList.push({subject:$scope.todoInput, done:false});
    //     $scope.todoInput = "";
    // };

    // $scope.remove = function() {
    //     var oldList = $scope.todoList;
    //     $scope.todoList = [];
    //     angular.forEach(oldList, function(todo) {
    //         if (!todo.completed) $scope.todoList.push(todo);
    //     });
    // };

     $scope.remaining = function() {
       var count = 0;
       angular.forEach($scope.todoList, function(todo) {
           count += todo.completed ? 0 : 1;
       });
         return count;
       };


      $scope.todoList = [];

  // Get all todos
  $http.get('http://rest.learncode.academy/api/johnbob/r2-1')
    .success(function(todos) {
     // $scope.loaded = true;
      $scope.todoList = todos;
    }).error(function(err) {
      alert(err);
    });

     $scope.todoAdd = function(subject) {
    $http.post('http://rest.learncode.academy/api/johnbob/r2-1', {
      subject: subject
    }).success(function(todo) {
       $scope.newtodoInput = "";
       $scope.todoList.push(todo);
       
        
    }).error(function(err) {
      // Alert if there's an error
      return alert(err.message || "an error occurred");
    });
  };

  //  $scope.changeCompleted = function(todo) {
  //   // Update the todo
  //   $http.put('http://rest.learncode.academy/api/johnbob/r2-1' + todo.id, {
  //     completed: todo.completed
  //   }).error(function(err) {
  //     return alert(err.message || (err.errors && err.errors.completed) || "an error occurred");
  //   });
  // };

  $scope.remove = function(todo) {
    $http.delete('http://rest.learncode.academy/api/johnbob/r2-1', {
        // params: {
        //     data : subject ;
        // }
      
    }).success(function(todo) {

      var oldList = $scope.todoList;
        $scope.todoList = [];
        angular.forEach(oldList, function(todo) {
            if (!todo.completed) $scope.todoList.push(todo);
        });
     // var index = $scope.todoList.indexOf(todo);
     // $scope.todoList.splice(index, 1);
    }).error(function(err) {
      alert(err.message || "an error occurred");
    });
  };

  

});
</script>

</body>
</html>
